{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{2951:function(e,t,a){var s=a(5),r=a(2952);\"string\"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,\"\"]]);var i={insert:\"head\",singleton:!1};s(r,i);e.exports=r.locals||{}},2952:function(e,t,a){(t=a(6)(!1)).push([e.i,\".ide-loader-page {\\n  overflow: hidden;\\n  padding-left: 0;\\n  padding-right: 0;\\n  padding-bottom: 0;\\n}\\n.ide-loader-page .pf-c-empty-state {\\n  padding-bottom: calc(100vh - 380px);\\n}\\n.ide-loader-wizard .pf-c-wizard__nav {\\n  width: 100%;\\n  border: none;\\n  pointer-events: none;\\n}\\n.ide-loader-wizard .pf-c-wizard__nav .error {\\n  color: #000;\\n}\\n.ide-loader-wizard .pf-c-wizard__nav .error,\\n.ide-loader-wizard .pf-c-wizard__nav .progress {\\n  font-weight: bold;\\n}\\n.ide-loader-wizard .pf-c-wizard__nav .progress {\\n  color: #0766cc;\\n}\\n.ide-loader-wizard .pf-c-wizard__nav .pf-c-wizard__nav-link {\\n  margin-left: 8px;\\n}\\n.ide-loader-wizard .pf-c-wizard__nav .pf-c-wizard__nav-link > svg {\\n  margin-right: 5px;\\n}\\n.ide-loader-wizard .pf-c-wizard__nav .pf-c-wizard__nav-link .wizard-icon {\\n  position: absolute;\\n  left: -56px;\\n  top: 3px;\\n}\\n.ide-loader-wizard .pf-c-wizard__toggle {\\n  padding-left: 56px;\\n}\\n.ide-loader-wizard .pf-c-wizard__toggle .pf-c-wizard__toggle-list-item > svg {\\n  margin-right: 5px;\\n}\\n.ide-loader-wizard .pf-c-wizard__toggle .pf-c-wizard__toggle-list-item .wizard-icon {\\n  position: absolute;\\n  left: -56px;\\n  top: 3px;\\n}\\n.ide-iframe-page {\\n  height: 100%;\\n  position: relative;\\n  background-color: #000;\\n}\\n#ide-iframe {\\n  width: 100%;\\n  height: 100%;\\n  border: none;\\n}\\n\",\"\"]),e.exports=t},2973:function(e,t,a){\"use strict\";a.r(t),a.d(t,\"LoadIdeSteps\",(function(){return L}));var s=a(2904),r=a(2856),i=a(1),o=a.n(i),n=a(59),c=a(23),l=a(2849),p=a(2907),d=a(2830),h=a(2903),m=a(2857),w=a(2900),u=a(2884),f=a(89),k=a(329),g=a(2921),I=a(2922),b=a(330),E=a(15),N=a(102),S=a.n(N);a(2951);const y=l.b.light;class v extends o.a.PureComponent{constructor(e){let t;super(e),this.state={alertVisible:!1,currentRequestError:\"\",workspaceId:this.props.workspaceId,activeTabKey:this.props.preselectedTabKey?this.props.preselectedTabKey:E.b.Progress},this.wizardRef=o.a.createRef(),this.handleTabClick=(e,t)=>{this.setState({activeTabKey:t}),this.state.activeTabKey===E.b.Progress&&this.setState({alertVisible:!1})},this.showAlert=e=>{this.setState({currentRequestError:e.title,currentAlertVariant:e.alertVariant,alertActionLinks:null==e?void 0:e.alertActionLinks,alertBody:null==e?void 0:e.body}),this.state.activeTabKey!==E.b.Progress&&(this.setState({alertVisible:!0}),t&&clearTimeout(t),t=window.setTimeout(()=>{this.setState({alertVisible:!1})},e.alertVariant===s.b.success?2e3:1e4))},this.hideAlert=()=>this.setState({alertVisible:!1}),this.props.callbacks&&!this.props.callbacks.showAlert&&(this.props.callbacks.showAlert=e=>{this.showAlert(e)})}componentDidMount(){this.props.ideUrl&&this.setState({ideUrl:this.props.ideUrl}),this.props.workspaceId&&this.setState({workspaceId:this.props.workspaceId})}async componentDidUpdate(){const{currentStep:e,hasError:t,ideUrl:a,workspaceId:s}=this.props,r=this.wizardRef.current;r&&r.state&&r.state.currentStep!==e&&!t&&(r.state.currentStep=e),!t&&this.state.currentRequestError&&this.setState({currentRequestError:\"\"}),this.state.workspaceId!==s&&this.setState({workspaceId:s,alertVisible:!1}),this.state.ideUrl!==a&&(this.setState({ideUrl:a}),a&&await this.updateIdeIframe(a,10))}async updateIdeIframe(e,t){const a=document.getElementById(\"ide-iframe\");if(a)a.src=e;else{if(t)return await Object(b.a)(500),this.updateIdeIframe(e,--t);{const e=\"Cannot find IDE iframe element.\";this.showAlert({alertVariant:s.b.warning,title:e}),console.error(e)}}}getIcon(e,t=\"\"){const{currentStep:a,hasError:s}=this.props;return a>e?o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{className:t,color:\"green\"})):a===e?s?o.a.createElement(f.ExclamationCircleIcon,{className:t,color:\"red\"}):o.a.createElement(o.a.Fragment,null,o.a.createElement(f.InProgressIcon,{className:`${S.a.rotate} ${t}`,color:\"#0e6fe0\"})):\"\"}getSteps(){const{currentStep:e,hasError:t}=this.props,a=(a,s,r)=>{let i=\"\";return e===a&&(i=t?\"error\":\"progress\"),o.a.createElement(o.a.Fragment,null,this.getIcon(a,r),o.a.createElement(\"span\",{className:i},s))};return[{id:L.INITIALIZING,name:a(L.INITIALIZING,\"Initializing\",\"wizard-icon\"),canJumpTo:e>=L.INITIALIZING},{id:L.START_WORKSPACE,name:a(L.START_WORKSPACE,\"Waiting for workspace to start\",\"wizard-icon\"),canJumpTo:e>=L.START_WORKSPACE},{id:L.OPEN_IDE,name:a(L.OPEN_IDE,\"Open IDE\",\"wizard-icon\"),canJumpTo:e>=L.OPEN_IDE}]}render(){const{workspaceName:e,workspaceId:t,ideUrl:a,status:r,currentStep:i}=this.props,{alertVisible:n,currentAlertVariant:c,currentRequestError:u,alertActionLinks:f}=this.state;return a?o.a.createElement(\"div\",{className:\"ide-iframe-page\"},o.a.createElement(\"iframe\",{id:\"ide-iframe\",src:\"./static/loader.html\",allow:\"fullscreen *\"})):o.a.createElement(o.a.Fragment,null,o.a.createElement(k.a,{pageName:\"Loading \"+e}),n&&o.a.createElement(p.a,{isToast:!0},o.a.createElement(s.a,{variant:c,title:u,actionClose:o.a.createElement(d.a,{onClose:this.hideAlert})})),o.a.createElement(g.a,{title:\"Starting workspace \"+e,status:r}),o.a.createElement(l.a,{variant:y,className:\"ide-loader-page\",isFilled:!0},o.a.createElement(h.a,{activeKey:this.state.activeTabKey,onSelect:this.handleTabClick,inset:{default:\"insetLg\"},id:\"ide-loader-page-tabs\"},o.a.createElement(m.a,{eventKey:E.b.Progress,title:E.b[E.b.Progress],id:\"ide-loader-page-wizard-tab\"},o.a.createElement(l.a,null,this.state.currentRequestError&&o.a.createElement(s.a,{isInline:!0,variant:c,title:u,actionClose:o.a.createElement(d.a,{onClose:()=>this.setState({currentRequestError:\"\"})}),actionLinks:f},this.state.alertBody),o.a.createElement(w.a,{className:\"ide-loader-wizard\",steps:this.getSteps(),ref:this.wizardRef,footer:o.a.createElement(\"span\",null),height:500,startAtStep:i}))),o.a.createElement(m.a,{eventKey:E.b.Logs,title:E.b[E.b.Logs],id:\"ide-loader-page-logs-tab\"},o.a.createElement(I.a,{workspaceId:t})))))}}var A=v,T=a(356),_=a(263),R=a(113),O=a(255),z=a(87),P=a.n(z);var L,W=a(114),C=a(334),D=function(e,t,a,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,a):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,s);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(i<3?r(o):i>3?r(t,a,o):r(t,a))||o);return i>3&&o&&Object.defineProperty(t,a,o),o},K=function(e,t){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e[e.INITIALIZING=1]=\"INITIALIZING\",e[e.START_WORKSPACE=2]=\"START_WORKSPACE\",e[e.OPEN_IDE=3]=\"OPEN_IDE\"}(L||(L={}));class U extends o.a.PureComponent{constructor(e){super(e),this.toDispose=new C.a;const t=Object(_.a)();this.isDevEnvironment=Object(_.b)(t),this.loadFactoryPageCallbacks={};const{match:{params:a},history:s}=this.props,r=a.namespace,i=this.workspaceName.split(\"&\")[0];if(i!==this.workspaceName){const e=`/ide/${r}/${i}`;s.replace({pathname:e})}const o=this.props.allWorkspaces.find(e=>e.namespace===a.namespace&&e.devfile.metadata.name===this.workspaceName);this.state={currentStep:L.INITIALIZING,namespace:r,workspaceName:i,hasError:(null==o?void 0:o.status)===E.e[E.e.ERROR],preselectedTabKey:this.preselectedTabKey};const n=async()=>{await this.initWorkspace()};this.debounce.subscribe(n),this.toDispose.push({dispose:()=>{this.debounce.unsubscribe(n)}})}get workspaceName(){const{match:{params:e}}=this.props;return e.workspaceName.split(\"?\")[0]}get preselectedTabKey(){const{history:{location:{search:e}}}=this.props;if(!e)return E.b.Progress;const t=new URLSearchParams(e).get(\"tab\");return t?E.b[t]:E.b.Progress}showAlert(e){if(\"string\"==typeof e){e={title:e,alertVariant:s.b.danger}}e.alertVariant===s.b.danger&&this.setState({hasError:!0}),this.loadFactoryPageCallbacks.showAlert?this.loadFactoryPageCallbacks.showAlert(e):console.error(e.title)}async componentWillUnmount(){this.toDispose.dispose()}async componentDidMount(){const{isLoading:e,requestWorkspaces:t,allWorkspaces:a}=this.props;let s=a.find(e=>e.namespace===this.state.namespace&&e.devfile.metadata.name===this.state.workspaceName);if(e||s||(await t(),s=a.find(e=>e.namespace===this.state.namespace&&e.devfile.metadata.name===this.state.workspaceName)),s&&s.runtime&&s.status===E.e[E.e.RUNNING])return await this.updateIdeUrl(s.runtime);s&&s.status==E.e[E.e.ERROR]&&this.showErrorAlert(s),this.debounce.setDelay(1e3);const r=async e=>{if(\"string\"==typeof e.data)if(\"show-workspaces\"===e.data){const e=Object(W.e)();this.props.history.push({pathname:e}),window.postMessage(\"show-navbar\",\"*\")}else if(e.data.startsWith(\"restart-workspace:\")){const{allWorkspaces:t,match:{params:a}}=this.props,s=t.find(e=>e.namespace===a.namespace&&e.devfile.metadata.name===this.workspaceName);if(!s)return;const[,r,i]=e.data.split(\":\");if(s.id!==r)return;try{await async function(e,t){if(!t)throw new Error(\"Failed to validate machine token\");try{await P()({method:\"GET\",url:\"/api/workspace/\"+e,headers:{Authorization:\"Bearer \"+t}})}catch(e){if(304!==e.status)throw new Error(\"Failed to validate machine token, \"+e)}}(s.id,i),await this.props.stopWorkspace(s),await this.props.requestWorkspace(s),this.setState({currentStep:L.INITIALIZING}),window.postMessage(\"show-navbar\",\"*\")}catch(e){console.error(\"Machine token validation failed. \",e)}}};window.addEventListener(\"message\",r,!1),this.toDispose.push({dispose:()=>{window.removeEventListener(\"message\",r)}})}showErrorAlert(e){const t=this.props.workspacesLogs.get(e.id)||[],a=this.errorActionLinks(e);this.showAlert({alertActionLinks:a,title:`Workspace ${this.state.workspaceName} failed to start`,body:this.findErrorLogs(t).join(\"\\n\"),alertVariant:s.b.danger})}async componentDidUpdate(e,t){const{allWorkspaces:a,match:{params:r}}=this.props,{hasError:i}=this.state,o=a.find(e=>e.namespace===r.namespace&&e.devfile.metadata.name===this.workspaceName);if(o)o.status===E.e[E.e.ERROR]?t.workspaceName!==this.workspaceName||i?t.workspaceName!==this.workspaceName&&(this.setState({hasError:!0,workspaceName:this.workspaceName,currentStep:L.START_WORKSPACE,workspaceId:o.id}),this.showErrorAlert(o)):this.showErrorAlert(o):t.workspaceName!==this.workspaceName&&this.setState({hasError:!1,workspaceName:this.workspaceName,currentStep:L.INITIALIZING,workspaceId:o.id});else{const e={title:`Workspace \"${this.workspaceName}\" is not found.`,alertVariant:s.b.danger};this.loadFactoryPageCallbacks.showAlert?this.loadFactoryPageCallbacks.showAlert(e):console.error(e.title),this.setState({hasError:!0})}this.debounce.setDelay(1e3)}findErrorLogs(e){const t=[];return e.forEach(e=>{if(e.startsWith(\"Error: Failed to run the workspace\")){const a=e.replace(\"Error: Failed to run the workspace: \",\"\").slice(1,-1);t.push(a)}}),t}errorActionLinks(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(r.a,{onClick:async()=>{this.verboseModeHandler(e)}},\"Open in Verbose mode\"),o.a.createElement(r.a,{onClick:()=>{this.logsHandler()}},\"Open Logs\"))}async verboseModeHandler(e){try{await this.props.startWorkspace(e,{\"debug-workspace-start\":!0}),this.props.deleteWorkspaceLogs(e.id),this.setState({currentStep:L.INITIALIZING,hasError:!1}),e.status=\"STARTING\",this.logsHandler()}catch(e){this.showAlert(`Workspace ${this.state.workspaceName} failed to start. ${e}`)}}logsHandler(){const e=Array.from(document.getElementsByClassName(\"pf-c-tabs__item\"));for(const t of e)\"Logs\"===t.innerText&&t.firstChild.click()}async updateIdeUrl(e){let t=\"\";const a=e.machines||{};for(const e of Object.keys(a)){const s=a[e].servers||{};for(const e of Object.keys(s)){const a=s[e].attributes;if(a&&\"ide\"===a.type){t=s[e].url;break}}}if(t){if(this.isDevEnvironment)try{const e=window.open(t);await Object(b.a)(2e3),null==e||e.close()}catch(e){}this.setState({currentStep:L.OPEN_IDE,ideUrl:t})}else this.showAlert(\"Don't know what to open, IDE url is not defined.\")}async openIDE(e){this.setState({currentStep:L.OPEN_IDE});try{await this.props.requestWorkspace(e)}catch(e){return void this.showAlert(\"Getting workspace detail data failed. \"+e)}const t=this.props.allWorkspaces.find(t=>t.id===e.id);t&&t.runtime&&await this.updateIdeUrl(t.runtime)}async initWorkspace(){const{allWorkspaces:e,match:{params:t}}=this.props,{namespace:a,workspaceName:s}=this.state,r=e.find(e=>e.namespace===t.namespace&&e.devfile.metadata.name===this.workspaceName);if(a===t.namespace&&s===this.workspaceName){if(this.state.currentStep!==L.OPEN_IDE){if(!r)return this.props.workspace&&this.props.clearWorkspaceId(),void this.showAlert(\"Failed to find the target workspace.\");if(this.props.setWorkspaceId(r.id),this.setState({workspaceId:r.id}),(r.runtime||this.state.currentStep===L.START_WORKSPACE)&&r.status===E.e[E.e.RUNNING])return this.openIDE(r);if(this.state.currentStep===L.INITIALIZING&&(this.setState({currentStep:L.START_WORKSPACE}),r.status===E.e[E.e.STOPPED]&&!this.state.hasError))try{await this.props.startWorkspace(r)}catch(e){return void this.showAlert(`Workspace ${this.state.workspaceName} failed to start. ${e}`)}}}else this.setState({currentStep:L.INITIALIZING,hasError:(null==r?void 0:r.status)===E.e[E.e.ERROR],ideUrl:\"\",namespace:t.namespace,workspaceName:this.workspaceName})}render(){const{currentStep:e,hasError:t,ideUrl:a,workspaceId:s,workspaceName:r,preselectedTabKey:i}=this.state,{workspace:n}=this.props;return o.a.createElement(A,{currentStep:e,workspaceId:s||\"\",preselectedTabKey:i,ideUrl:a,hasError:t,status:n?n.status:void 0,workspaceName:r||\"\",callbacks:this.loadFactoryPageCallbacks})}}D([Object(c.b)(T.a),K(\"design:type\",T.a)],U.prototype,\"debounce\",void 0);const j=Object(n.c)(e=>({workspace:Object(O.h)(e),allWorkspaces:Object(O.a)(e),isLoading:Object(O.c)(e),workspacesLogs:Object(O.d)(e)}),R.a);t.default=j(U)}}]);","extractedComments":[]}