{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{2971:function(e,t,s){\"use strict\";s.r(t),s.d(t,\"UserPreferences\",(function(){return te}));var a=s(2904),r=s(2849),i=s(2834),n=s(2903),l=s(2857),o=s(2911),d=s(2912),c=s(196),h=s(136),g=s(2863),p=s(94),u=s(2906),m=s(2902),y=s(1),C=s.n(y),E=s(59),v=s(329),f=s(2914),R=s(23),b=s(116),w=s(30),O=s(357),M=s(83);const k=e=>e.userPreferences,I=Object(M.a)(k,e=>e.isLoading),V=Object(M.a)(k,e=>e.preferences),S=Object(M.a)(k,e=>function(e){const t=[];if(e.dockerCredentials){const s=JSON.parse(atob(e.dockerCredentials));for(const[e,a]of Object.entries(s)){const{username:s,password:r}=a||{};t.push({url:e,username:s,password:r})}}return t}(e.preferences));var x=s(2864),D=s(2865),U=s(2866),A=s(2885);class P extends C.a.PureComponent{render(){return C.a.createElement(x.a,{isFullHeight:!0,variant:x.b.small},C.a.createElement(D.a,{icon:A.a}),C.a.createElement(i.a,{headingLevel:\"h4\",size:\"lg\"},\"No Container Registries\"),C.a.createElement(U.a,null,C.a.createElement(h.a,{icon:C.a.createElement(g.a,null),\"aria-label\":\"add-registry\",variant:\"link\",onClick:()=>this.props.onAddRegistry()},\"Add Container Registry\")))}}var T=s(2831),j=s(2853),$=s(2858),F=s(2897);class H extends C.a.PureComponent{constructor(e){super(e),this.state={warningInfoCheck:!1}}componentDidUpdate(e){e.isOpen===this.props.isOpen&&this.props.isOpen||this.setState({warningInfoCheck:!1})}getDeleteModalContent(){const{registry:e,selectedItems:t}=this.props;let s=\"Would you like to delete \";return e?s+=`registry '${e.url}'`:1===t.length?s+=`registry '${t[0]}'`:s+=t.length+\" registries\",s+=\"?\",C.a.createElement(T.a,null,C.a.createElement(j.a,null,s),C.a.createElement($.a,{style:{margin:\"0 0 0 0.4rem\"},\"data-testid\":\"warning-info-checkbox\",isChecked:this.state.warningInfoCheck,onChange:()=>{this.setState({warningInfoCheck:!this.state.warningInfoCheck})},id:\"delete-warning-info-check\",label:\"I understand, this operation cannot be reverted.\"}))}render(){const{isOpen:e,onCancel:t,onDelete:s,registry:a}=this.props,{warningInfoCheck:r}=this.state;return C.a.createElement(F.a,{title:\"Delete Container Registr\"+(void 0!==a?\"y\":\"ies\"),titleIconVariant:\"warning\",variant:F.b.small,isOpen:e,onClose:t,\"aria-label\":\"warning-info\",footer:C.a.createElement(C.a.Fragment,null,C.a.createElement(h.a,{variant:h.b.danger,isDisabled:!r,\"data-testid\":\"delete-button\",onClick:()=>s(a)},\"Delete\"),C.a.createElement(h.a,{variant:h.b.link,\"data-testid\":\"cancel-button\",onClick:t},\"Cancel\"))},this.getDeleteModalContent())}}var L=s(53),q=s(2882),K=s(2879),N=s(2887),_=s(2888),z=s(2876),J=s(2886),B=s(2859);class W extends C.a.PureComponent{constructor(e){super(e);const t=this.props.password||\"\",s=L.ValidatedOptions.default;this.state={password:t,valid:s,isHidden:!0}}componentDidUpdate(e){const t=this.props.password||\"\";e.password!==t&&this.setState({password:t})}onChange(e){if(this.state.password===e)return;const{onChange:t}=this.props,{errorMessage:s,valid:a}=this.validate(e);this.setState({password:e,valid:a,errorMessage:s}),t&&t(e,a)}validate(e){return 0===e.length?{errorMessage:\"A value is required.\",valid:L.ValidatedOptions.error}:e.length>1e4?{errorMessage:\"The password is too long. The maximum length is 10000 characters.\",valid:L.ValidatedOptions.error}:{valid:L.ValidatedOptions.success}}render(){const{password:e,errorMessage:t,valid:s,isHidden:a}=this.state;return C.a.createElement(z.a,{style:{gridTemplateColumns:\"80px\",minHeight:\"65px\"},label:\"Password\",fieldId:\"id-password-helper\",helperTextInvalid:t,isRequired:!0,helperTextInvalidIcon:C.a.createElement(K.a,null),validated:s},C.a.createElement(J.a,null,C.a.createElement(B.a,{\"data-testid\":\"registry-password-input\",\"aria-label\":\"Password input\",placeholder:\"Enter a password\",type:a?\"password\":\"text\",value:e,validated:s,onChange:e=>this.onChange(e)}),C.a.createElement(h.a,{variant:\"control\",\"aria-label\":\"show\",onClick:()=>this.setState({isHidden:!a})},a?C.a.createElement(N.a,null):C.a.createElement(_.a,null))))}}var Z=s(2868);class G extends C.a.PureComponent{constructor(e){super(e);const t=this.props.url,s=L.ValidatedOptions.default;this.state={url:t,valid:s}}componentDidUpdate(e){const{url:t}=this.props;if(e.url!==t){const e=new RegExp(\"^http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\\\(\\\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+$\").test(t);this.setState({url:t,isUrl:e})}}onChange(e){if(this.state.url===e)return;const{onChange:t}=this.props,{errorMessage:s,valid:a}=this.validate(e);this.setState({url:e,valid:a,errorMessage:s}),t&&t(e,a)}validate(e){return 0===e.length?{errorMessage:\"A value is required.\",valid:L.ValidatedOptions.error}:e.length>256?{errorMessage:\"The url is too long. The maximum length is 256 characters.\",valid:L.ValidatedOptions.error}:{errorMessage:void 0,valid:L.ValidatedOptions.success}}render(){const{url:e,isUrl:t,errorMessage:s,valid:a}=this.state;return C.a.createElement(z.a,{style:{gridTemplateColumns:\"80px\",minHeight:\"65px\"},label:\"Registry\",fieldId:\"id-registry-helper\",helperTextInvalid:s,isRequired:!0,helperTextInvalidIcon:C.a.createElement(K.a,null),validated:a},C.a.createElement(J.a,null,C.a.createElement(B.a,{\"aria-label\":\"Url input\",placeholder:\"Enter a registry\",type:\"url\",value:e,validated:a,onChange:e=>this.onChange(e)}),C.a.createElement(h.a,{variant:\"link\",isDisabled:!e||!t,\"aria-label\":\"open registry\"},C.a.createElement(\"a\",{href:e,style:{color:\"inherit\"},target:\"_blank\",rel:\"noreferrer\"},C.a.createElement(Z.a,null)))))}}class Q extends C.a.PureComponent{constructor(e){super(e);const t=this.props.username||\"\",s=L.ValidatedOptions.default;this.state={username:t,valid:s}}componentDidUpdate(e){const t=this.props.username||\"\";e.username!==t&&this.setState({username:t})}onChange(e){if(this.state.username===e)return;const{onChange:t}=this.props,{errorMessage:s,valid:a}=this.validate(e);this.setState({username:e,valid:a,errorMessage:s}),t&&t(e,a)}validate(e){return e.length>100?{errorMessage:\"The username is too long. The maximum length is 100 characters.\",valid:L.ValidatedOptions.error}:{errorMessage:void 0,valid:L.ValidatedOptions.success}}render(){const{username:e,errorMessage:t,valid:s}=this.state;return C.a.createElement(z.a,{style:{gridTemplateColumns:\"80px\",minHeight:\"65px\"},label:\"Username\",fieldId:\"id-username-helper\",helperTextInvalid:t,validated:s},C.a.createElement(B.a,{\"aria-label\":\"Username input\",placeholder:\"Enter a username\",value:e,validated:s,onChange:e=>this.onChange(e)}))}}class X extends C.a.PureComponent{constructor(e){super(e);const{registry:t}=this.props;this.state={editRegistry:t,urlValid:L.ValidatedOptions.default,usernameValid:L.ValidatedOptions.default,passwordValid:L.ValidatedOptions.default}}componentDidUpdate(e){const{isOpen:t,registry:s}=this.props;t===e.isOpen&&s.url===e.registry.url||this.setState({editRegistry:s,urlValid:L.ValidatedOptions.default,usernameValid:L.ValidatedOptions.default,passwordValid:L.ValidatedOptions.default})}handleRegistryChange(){const{onChange:e}=this.props,{editRegistry:t}=this.state;e(t)}handleUrlChange(e,t){const{editRegistry:s,urlValid:a}=this.state;s.url!==e?this.setState({editRegistry:Object.assign({},s,{url:e}),urlValid:t}):a!==t&&this.setState({urlValid:t})}handleUsernameChange(e,t){const{editRegistry:s,usernameValid:a}=this.state;s.username!==e?this.setState({editRegistry:Object.assign({},s,{username:e}),usernameValid:t}):a!==t&&this.setState({usernameValid:t})}handlePasswordChange(e,t){const{editRegistry:s,passwordValid:a}=this.state;s.password!==e?this.setState({editRegistry:Object.assign({},s,{password:e}),passwordValid:t}):a!==t&&this.setState({passwordValid:t})}get isUrlChange(){return this.props.registry.url!==this.state.editRegistry.url}get isUsernameChange(){return this.props.registry.username!==this.state.editRegistry.username}get isPasswordChange(){return this.props.registry.password!==this.state.editRegistry.password}get isUrlValid(){const{urlValid:e,editRegistry:{url:t}}=this.state;return e!==L.ValidatedOptions.error&&t.length>0}get isUsernameValid(){return this.state.usernameValid!==L.ValidatedOptions.error}get isPasswordValid(){const{passwordValid:e,editRegistry:{password:t}}=this.state;return e!==L.ValidatedOptions.error&&void 0!==t&&t.length>0}getRegistryModalFooter(){const{onCancel:e,isEditMode:t}=this.props,s=!((this.isUrlChange||this.isUsernameChange||this.isPasswordChange)&&this.isUrlValid&&this.isUsernameValid&&this.isPasswordValid);return C.a.createElement(C.a.Fragment,null,C.a.createElement(h.a,{variant:h.b.primary,isDisabled:s,\"data-testid\":\"edit-button\",onClick:()=>this.handleRegistryChange()},t?\"Save\":\"Add\"),C.a.createElement(h.a,{variant:h.b.link,\"data-testid\":\"cancel-button\",onClick:e},\"Cancel\"))}render(){const{isOpen:e,onCancel:t,isEditMode:s}=this.props,{editRegistry:a}=this.state;return C.a.createElement(F.a,{title:(s?\"Edit\":\"Add\")+\" Container Registry\",variant:F.b.small,isOpen:e,onClose:t,\"aria-label\":\"edit-registry-info\",footer:this.getRegistryModalFooter()},C.a.createElement(q.a,{isHorizontal:!0,onSubmit:e=>e.preventDefault()},C.a.createElement(G,{url:a.url,onChange:(e,t)=>this.handleUrlChange(e,t)}),C.a.createElement(Q,{username:a.username,onChange:(e,t)=>this.handleUsernameChange(e,t)}),C.a.createElement(W,{password:a.password,onChange:(e,t)=>this.handlePasswordChange(e,t)})))}}var Y=function(e,t,s,a){var r,i=arguments.length,n=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,s):a;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,a);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(n=(i<3?r(n):i>3?r(t,s,n):r(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},ee=function(e,t){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class te extends C.a.PureComponent{constructor(e){super(e);const t=this.props.registries;this.state={registries:t,currentRegistry:{url:\"\",password:\"\",username:\"\"},selectedItems:[],activeTabKey:\"container-registries\",currentRegistryIndex:-1,isEditModalOpen:!1,isDeleteModalOpen:!1}}onChangeRegistrySelection(e,t){let s=[...this.state.registries];if(-1===t){s=s.map(e=>e);const t=e?s.map(e=>e.url):[];this.setState({registries:s,selectedItems:t})}else{const a=s[t].url;this.setState(t=>({registries:s,selectedItems:e?[...t.selectedItems,a]:t.selectedItems.filter(e=>e!==a)}))}}componentDidMount(){const{preferences:e,isLoading:t,requestUserPreferences:s}=this.props;t||e.dockerCredentials||s(void 0)}componentDidUpdate(e,t){if(e.preferences.dockerCredentials!==this.props.preferences.dockerCredentials){const e=this.props.registries,t=[];this.state.selectedItems.forEach(s=>{void 0!==e.find(e=>e.url===s)&&t.push(s)}),this.setState({registries:e,selectedItems:t})}if(t.currentRegistryIndex!==this.state.currentRegistryIndex){const e=this.getCurrentRegistry();this.setState({currentRegistry:e})}}showAlert(e){this.appAlerts.showAlert(e)}handleTabClick(e){this.props.history.push(`${w.a.USER_PREFERENCES}?tab=${e}`),this.setState({activeTabKey:e})}buildRegistryRow(e){const{url:t,username:s}=e;return/^http[s]?:\\/\\/.*/.test(t)?[C.a.createElement(\"span\",{key:\"host\"},C.a.createElement(\"a\",{href:t,target:\"_blank\",rel:\"noreferrer\"},t)),C.a.createElement(\"span\",{key:\"username\"},s)]:[C.a.createElement(\"span\",{key:\"host\"},t),C.a.createElement(\"span\",{key:\"username\"},s)]}showOnAddRegistryModal(){this.setState({currentRegistryIndex:-1,isEditModalOpen:!0})}showOnEditRegistryModal(e){this.setState({currentRegistryIndex:e,isEditModalOpen:!0})}showOnDeleteRegistryModal(e){this.setState({currentRegistryIndex:e,isDeleteModalOpen:!0})}async onDelete(e){let t;if(void 0===e)t=this.state.registries.filter(e=>!this.state.selectedItems.includes(e.url));else{t=[...this.state.registries];const s=t.findIndex(t=>t.url===e.url);if(!(s>-1))return void this.showAlert({key:\"delete-registry-fail\",variant:a.b.danger,title:\"Unable to find the target registry.\"});t.splice(s,1)}this.setState({isDeleteModalOpen:!1,currentRegistryIndex:-1});try{e||this.setState({selectedItems:[]}),await this.props.updateContainerRegistries(t),this.showAlert({key:\"delete-success\",variant:a.b.success,title:`Registr${e?\"y\":\"ies\"} successfully deleted.`})}catch(t){this.showAlert({key:\"delete-fail\",variant:a.b.danger,title:`Unable to delete the registr${e?\"y\":\"ies\"}. ${t}`})}}setEditModalStatus(e){this.state.isEditModalOpen!==e&&this.setState({isEditModalOpen:e})}setDeleteModalStatus(e){this.state.isDeleteModalOpen!==e&&this.setState({isDeleteModalOpen:e})}handleDelete(){this.setState({currentRegistryIndex:-1,isDeleteModalOpen:!0})}async onRegistriesChange(e){const t=this.isEditMode;this.setState({isEditModalOpen:!1,currentRegistryIndex:-1});try{await this.props.updateContainerRegistries(e),this.showAlert({key:\"edit-registry-success\",variant:a.b.success,title:`Registry successfully ${t?\"saved\":\"added\"}.`})}catch(e){this.showAlert({key:\"edit-registry-fail\",variant:a.b.danger,title:`Unable to ${t?\"save\":\"add\"} the registry. ${e}`})}}get isEditMode(){const{registries:e}=this.props,{currentRegistryIndex:t}=this.state;return t>-1&&t<e.length}getCurrentRegistry(){const{registries:e}=this.props,{currentRegistryIndex:t}=this.state;return this.isEditMode?Object.assign({},e[t]):{url:\"\",password:\"\",username:\"\"}}handleRegistryChange(e){const{registries:t}=this.props,{currentRegistryIndex:s}=this.state;this.isEditMode?t[s]=e:t.push(e),this.onRegistriesChange(t)}render(){const{isLoading:e}=this.props,{isEditModalOpen:t,isDeleteModalOpen:s,currentRegistry:a,currentRegistryIndex:y,selectedItems:E}=this.state,R=this.state.registries.map(e=>({cells:this.buildRegistryRow(e),selected:E.includes(e.url)}))||[],b=[{title:\"Edit registry\",onClick:(e,t)=>this.showOnEditRegistryModal(t)},{title:\"Delete registry\",onClick:(e,t)=>this.showOnDeleteRegistryModal(t)}];return C.a.createElement(C.a.Fragment,null,C.a.createElement(v.a,{pageName:\"User Preferences\"}),C.a.createElement(r.a,{variant:r.b.light},C.a.createElement(i.a,{headingLevel:\"h1\"},\"User Preferences\")),C.a.createElement(n.a,{id:\"user-preferences-tabs\",style:{backgroundColor:\"var(--pf-global--BackgroundColor--100)\"},activeKey:this.state.activeTabKey,onSelect:(e,t)=>this.handleTabClick(t)},C.a.createElement(l.a,{id:\"container-registries-tab\",eventKey:\"container-registries\",title:\"Container Registries\"},C.a.createElement(f.a,{isLoading:e}),C.a.createElement(X,{onCancel:()=>this.setEditModalStatus(!1),onChange:e=>this.handleRegistryChange(e),isEditMode:this.isEditMode,registry:a,isOpen:t}),C.a.createElement(r.a,null,0===R.length?C.a.createElement(P,{onAddRegistry:()=>this.showOnAddRegistryModal()}):C.a.createElement(C.a.Fragment,null,C.a.createElement(H,{selectedItems:E,onCancel:()=>this.setDeleteModalStatus(!1),onDelete:e=>this.onDelete(e),isOpen:s,registry:-1!==y?a:void 0}),C.a.createElement(o.a,{id:\"registries-list-toolbar\",className:\"pf-m-page-insets\"},C.a.createElement(d.a,null,C.a.createElement(c.a,null,C.a.createElement(h.a,{variant:h.b.danger,isDisabled:0===this.state.selectedItems.length,\"data-testid\":\"bulk-delete-button\",onClick:()=>this.handleDelete()},\"Delete\")),C.a.createElement(c.a,{alignment:{md:\"alignRight\",lg:\"alignRight\",xl:\"alignRight\",\"2xl\":\"alignRight\"}},C.a.createElement(h.a,{variant:h.b.link,\"data-testid\":\"add-button\",icon:C.a.createElement(g.a,null),iconPosition:\"left\",onClick:()=>this.showOnAddRegistryModal()},\"Add Container Registry\")))),C.a.createElement(p.b,{cells:[\"Host\",\"Username\"],actions:b,rows:R,onSelect:(e,t,s)=>{this.onChangeRegistrySelection(t,s)},canSelectAll:!0,\"aria-label\":\"Container credentials\",variant:\"compact\"},C.a.createElement(u.a,null),C.a.createElement(m.a,null)))))))}}Y([Object(R.b)(b.a),ee(\"design:type\",b.a)],te.prototype,\"appAlerts\",void 0);const se=Object(E.c)(e=>({preferences:V(e),registries:S(e),isLoading:I(e)}),O.a);t.default=se(te)}}]);","extractedComments":[]}